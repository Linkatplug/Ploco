<Window x:Class="Ploco.Dialogs.PlanningPdfWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Planning PDF" Height="720" Width="1100"
        WindowStartupLocation="CenterOwner">
    <DockPanel>
        <ToolBar DockPanel.Dock="Top">
            <Button Content="Charger PDF" Click="LoadPdf_Click"/>
            <Button Content="Exporter PDF annoté" Margin="6,0,0,0" Click="ExportPdf_Click"/>
            <Button Content="Exporter CSV" Margin="6,0,0,0" Click="ExportCsv_Click"/>
            <Button Content="Recalibrer" Margin="6,0,0,0" Click="Recalibrate_Click"/>
            <Separator/>
            <TextBlock Text="Date :" VerticalAlignment="Center"/>
            <DatePicker x:Name="DocumentDatePicker" Width="140" Margin="6,0"/>
            <Separator/>
            <TextBlock Text="Zoom" VerticalAlignment="Center"/>
            <Slider x:Name="ZoomSlider" Width="140" Minimum="0.5" Maximum="2.5" Value="1.0" ValueChanged="ZoomSlider_ValueChanged"/>
            <TextBlock x:Name="ZoomLabel" Text="100%" Width="60" VerticalAlignment="Center" HorizontalAlignment="Center"/>
        </ToolBar>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <ScrollViewer x:Name="PdfScrollViewer" Grid.Column="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="PdfPages">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#FFDDDDDD" BorderThickness="1" Margin="8" Padding="8">
                                <Grid>
                                    <Image Source="{Binding PageImage}" Stretch="Fill"
                                           Width="{Binding PageWidth}" Height="{Binding PageHeight}"/>
                                    <Canvas Width="{Binding PageWidth}" Height="{Binding PageHeight}"
                                            Background="Transparent"
                                            AllowDrop="True"
                                            Drop="Overlay_Drop"
                                            DragOver="Overlay_DragOver"
                                            MouseLeftButtonDown="Overlay_MouseLeftButtonDown"
                                            MouseMove="Overlay_MouseMove"
                                            MouseLeftButtonUp="Overlay_MouseLeftButtonUp">
                                        <ItemsControl ItemsSource="{Binding Placements}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <Canvas />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemContainerStyle>
                                                <Style TargetType="ContentPresenter">
                                                    <Setter Property="Canvas.Left" Value="{Binding X}" />
                                                    <Setter Property="Canvas.Top" Value="{Binding Y}" />
                                                </Style>
                                            </ItemsControl.ItemContainerStyle>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Padding="4" CornerRadius="4" Background="{Binding StatusBrush}"
                                                            BorderBrush="#FF333333" BorderThickness="1"
                                                            PreviewMouseLeftButtonDown="Token_MouseLeftButtonDown"
                                                            PreviewMouseMove="Token_MouseMove">
                                                        <Border.ContextMenu>
                                                            <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                                                                <MenuItem Header="Modifier" Click="EditPlacement_Click"/>
                                                                <MenuItem Header="Supprimer" Click="DeletePlacement_Click"/>
                                                            </ContextMenu>
                                                        </Border.ContextMenu>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding LocNumber}" FontWeight="Bold" Foreground="White"/>
                                                            <TextBlock Text="{Binding BadgeText}" FontSize="10" Foreground="White"/>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Canvas>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <Border Grid.Column="1" BorderBrush="#FFDDDDDD" BorderThickness="1" Margin="8" Padding="8">
                <StackPanel>
                    <TextBlock Text="Calibration" FontWeight="Bold" Margin="0,0,0,8"/>
                    <TextBlock Text="Page active" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Calibration.PageLabel}" Margin="0,4,0,8"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <StackPanel Width="120">
                            <TextBlock Text="X départ (00:00)" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding Calibration.XStartText, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,8,0"/>
                        </StackPanel>
                        <StackPanel Width="120">
                            <TextBlock Text="X fin (24:00)" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding Calibration.XEndText, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Appliquer" Width="90" Click="ApplyCalibration_Click"/>
                        <Button Content="Ajouter ligne" Width="110" Margin="8,0,0,0" Click="AddCalibrationRow_Click"/>
                        <Button Content="Supprimer ligne" Width="110" Margin="8,0,0,0" Click="RemoveCalibrationRow_Click"/>
                    </StackPanel>
                    <DataGrid ItemsSource="{Binding Calibration.Rows}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              HeadersVisibility="Column"
                              Height="420">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Roulement" Binding="{Binding RoulementId}" Width="*"/>
                            <DataGridTextColumn Header="Y (PDF)" Binding="{Binding YCenter}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <TextBlock Text="{Binding Calibration.HelpText}" Foreground="SlateGray" Margin="0,8,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Grid>
    </DockPanel>
</Window>
