<Window x:Class="Ploco.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Ploco.Converters"
        xmlns:helpers="clr-namespace:Ploco.Helpers"
        Title="Ploco - Nouvelle version" Height="800" Width="1200"
        Icon="pack://application:,,,/img/train_logo.ico"
        Loaded="Window_Loaded" Closing="Window_Closing">
    <Window.Resources>
        <local:StatutToBrushConverter x:Key="StatutToBrushConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style x:Key="TileHeaderButton" TargetType="Button">
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="Padding" Value="4,0"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <ContextMenu x:Key="LocomotiveTileContextMenu">
            <MenuItem Header="Modifier statut" Click="MenuItem_ModifierStatut_Click"/>
            <MenuItem Header="Swap" Click="MenuItem_SwapPool_Click"/>
            <MenuItem Header="Retirer de la tuile" Click="MenuItem_RemoveFromTile_Click"/>
        </ContextMenu>
        <ContextMenu x:Key="LocomotiveListContextMenu">
            <MenuItem Header="Modifier statut" Click="MenuItem_ModifierStatut_Click"/>
            <MenuItem Header="Swap" Click="MenuItem_SwapPool_Click"/>
        </ContextMenu>
        <DataTemplate x:Key="DepotTileTemplate">
            <Border Background="White" BorderBrush="#FFB0B0B0" BorderThickness="1"
                    CornerRadius="6" Padding="8" Width="360"
                    AllowDrop="True"
                    Drop="Tile_Drop"
                    MouseLeftButtonDown="Tile_MouseLeftButtonDown"
                    MouseMove="Tile_MouseMove"
                    MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="{Binding DisplayTitle}" FontWeight="Bold" FontSize="14"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Style="{StaticResource TileHeaderButton}" Content="Renommer"
                                    Click="RenameTile_Click" Tag="{Binding}"/>
                            <Button Style="{StaticResource TileHeaderButton}" Content="Supprimer"
                                    Click="DeleteTile_Click" Tag="{Binding}"/>
                        </StackPanel>
                    </DockPanel>
                    <TextBlock Text="Locomotives" FontSize="12" Foreground="Gray" Margin="0,4,0,2"/>
                    <ListBox DataContext="{Binding MainTrack}"
                             ItemsSource="{Binding Locomotives}"
                             AllowDrop="True"
                             PreviewMouseLeftButtonDown="TrackLocomotives_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="TrackLocomotives_PreviewMouseMove"
                             Drop="TrackLocomotives_Drop">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                        Padding="4" Margin="2" CornerRadius="4"
                                        ContextMenu="{StaticResource LocomotiveTileContextMenu}">
                                    <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Button Content="Ajouter voie de sortie" Margin="0,6,0,4" Click="AddDepotOutput_Click" Tag="{Binding}"/>
                    <ItemsControl ItemsSource="{Binding OutputTracks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#FFE0E0E0" BorderThickness="1" CornerRadius="4" Padding="6" Margin="0,0,0,6">
                                    <StackPanel>
                                        <DockPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" DockPanel.Dock="Left"/>
                                            <TextBlock Text="Sortie" Foreground="SlateGray" DockPanel.Dock="Right" Margin="8,0,0,0"/>
                                        </DockPanel>
                                        <ListBox ItemsSource="{Binding Locomotives}"
                                                 AllowDrop="True"
                                                 PreviewMouseLeftButtonDown="TrackLocomotives_PreviewMouseLeftButtonDown"
                                                 PreviewMouseMove="TrackLocomotives_PreviewMouseMove"
                                                 Drop="TrackLocomotives_Drop">
                                            <ListBox.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ListBox.ItemsPanel>
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                                            Padding="4" Margin="2" CornerRadius="4"
                                                            ContextMenu="{StaticResource LocomotiveTileContextMenu}">
                                                        <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="GarageTileTemplate">
            <Border Background="White" BorderBrush="#FFB0B0B0" BorderThickness="1"
                    CornerRadius="6" Padding="8" Width="360"
                    AllowDrop="True"
                    Drop="Tile_Drop"
                    MouseLeftButtonDown="Tile_MouseLeftButtonDown"
                    MouseMove="Tile_MouseMove"
                    MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="{Binding DisplayTitle}" FontWeight="Bold" FontSize="14"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Style="{StaticResource TileHeaderButton}" Content="Renommer"
                                    Click="RenameTile_Click" Tag="{Binding}"/>
                            <Button Style="{StaticResource TileHeaderButton}" Content="Supprimer"
                                    Click="DeleteTile_Click" Tag="{Binding}"/>
                        </StackPanel>
                    </DockPanel>
                    <TextBlock Text="Zone principale" FontSize="12" Foreground="Gray" Margin="0,4,0,2"/>
                    <ListBox DataContext="{Binding MainTrack}"
                             ItemsSource="{Binding Locomotives}"
                             AllowDrop="True"
                             PreviewMouseLeftButtonDown="TrackLocomotives_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="TrackLocomotives_PreviewMouseMove"
                             Drop="TrackLocomotives_Drop">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                        Padding="4" Margin="2" CornerRadius="4"
                                        ContextMenu="{StaticResource LocomotiveTileContextMenu}">
                                    <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Button Content="Ajouter zone" Margin="0,6,0,4" Click="AddGarageZone_Click" Tag="{Binding}"/>
                    <ItemsControl ItemsSource="{Binding ZoneTracks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#FFE0E0E0" BorderThickness="1" CornerRadius="4" Padding="6" Margin="0,0,0,6">
                                    <StackPanel>
                                        <DockPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                                <Button Style="{StaticResource TileHeaderButton}" Content="Renommer"
                                                        Click="RenameZone_Click" Tag="{Binding}"/>
                                                <Button Style="{StaticResource TileHeaderButton}" Content="Supprimer"
                                                        Click="RemoveZone_Click" Tag="{Binding}"/>
                                            </StackPanel>
                                        </DockPanel>
                                        <ListBox ItemsSource="{Binding Locomotives}"
                                                 AllowDrop="True"
                                                 PreviewMouseLeftButtonDown="TrackLocomotives_PreviewMouseLeftButtonDown"
                                                 PreviewMouseMove="TrackLocomotives_PreviewMouseMove"
                                                 Drop="TrackLocomotives_Drop">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                                            Padding="4" Margin="2" CornerRadius="4"
                                                            ContextMenu="{StaticResource LocomotiveTileContextMenu}">
                                                        <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="LineTileTemplate">
            <Border Background="White" BorderBrush="#FFB0B0B0" BorderThickness="1"
                    CornerRadius="6" Padding="8" Width="360"
                    AllowDrop="True"
                    Drop="Tile_Drop"
                    MouseLeftButtonDown="Tile_MouseLeftButtonDown"
                    MouseMove="Tile_MouseMove"
                    MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="{Binding DisplayTitle}" FontWeight="Bold" FontSize="14"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Style="{StaticResource TileHeaderButton}" Content="Renommer"
                                    Click="RenameTile_Click" Tag="{Binding}"/>
                            <Button Style="{StaticResource TileHeaderButton}" Content="Supprimer"
                                    Click="DeleteTile_Click" Tag="{Binding}"/>
                        </StackPanel>
                    </DockPanel>
                    <Button Content="Ajouter voie" Margin="0,6,0,4" Click="AddLineTrack_Click" Tag="{Binding}"/>
                    <ItemsControl ItemsSource="{Binding LineTracks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#FFE0E0E0" BorderThickness="1" CornerRadius="4" Padding="6" Margin="0,0,0,6">
                                    <StackPanel>
                                        <DockPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                            <Button DockPanel.Dock="Right" Style="{StaticResource TileHeaderButton}"
                                                    Content="Supprimer" Click="RemoveLineTrack_Click" Tag="{Binding}"/>
                                        </DockPanel>
                                        <TextBlock Text="{Binding LineInfo}" FontSize="11" Foreground="SlateGray" Margin="0,2,0,4"/>
                                        <ListBox ItemsSource="{Binding Locomotives}"
                                                 AllowDrop="True"
                                                 PreviewMouseLeftButtonDown="TrackLocomotives_PreviewMouseLeftButtonDown"
                                                 PreviewMouseMove="TrackLocomotives_PreviewMouseMove"
                                                 Drop="TrackLocomotives_Drop">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                                            Padding="4" Margin="2" CornerRadius="4"
                                                            ContextMenu="{StaticResource LocomotiveTileContextMenu}">
                                                        <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </DataTemplate>
        <helpers:TileTemplateSelector x:Key="TileTemplateSelector"
                                    DepotTemplate="{StaticResource DepotTileTemplate}"
                                    GarageTemplate="{StaticResource GarageTileTemplate}"
                                    LineTemplate="{StaticResource LineTileTemplate}"/>
    </Window.Resources>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="Fichier">
                <MenuItem Header="Sauvegarder" Click="MenuItem_Save_Click"/>
                <MenuItem Header="Charger" Click="MenuItem_Load_Click"/>
            </MenuItem>
            <MenuItem Header="Gestion">
                <MenuItem Header="Gestion des parcs" Click="MenuItem_PoolManagement_Click"/>
                <MenuItem Header="Historique" Click="MenuItem_History_Click"/>
            </MenuItem>
            <MenuItem Header="Option">
                <MenuItem Header="Reset (debug)" Click="MenuItem_Reset_Click"/>
            </MenuItem>
        </Menu>
        <ToolBar DockPanel.Dock="Top">
            <Button Content="Ajouter un lieu" Click="AddPlace_Click"/>
        </ToolBar>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0" Margin="10" Background="#FFEFF4FF" CornerRadius="6">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Locomotives" FontWeight="Bold" Margin="8"/>
                    <ListBox x:Name="LocomotiveList"
                             PreviewMouseLeftButtonDown="LocomotiveList_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="LocomotiveList_PreviewMouseMove">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Visibility"
                                        Value="{Binding IsVisibleInActivePool, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{Binding Status, Converter={StaticResource StatutToBrushConverter}}"
                                        Padding="6" Margin="4" CornerRadius="4"
                                        ContextMenu="{StaticResource LocomotiveListContextMenu}">
                                    <TextBlock Text="{Binding Number}" Foreground="White" FontWeight="Bold"
                                               HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>
            <Border Grid.Column="1" Margin="10" Background="#FFF7F7F7" CornerRadius="6">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="TileCanvas">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Canvas.Left" Value="{Binding X}" />
                                <Setter Property="Canvas.Top" Value="{Binding Y}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ContentControl Content="{Binding}" ContentTemplateSelector="{StaticResource TileTemplateSelector}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </Grid>
    </DockPanel>
</Window>
